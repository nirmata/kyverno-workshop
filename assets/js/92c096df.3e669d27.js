"use strict";(self.webpackChunkkyverno_workshop=self.webpackChunkkyverno_workshop||[]).push([[577],{3905:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>k});var r=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var s=r.createContext({}),p=function(e){var t=r.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},c=function(e){var t=p(e.components);return r.createElement(s.Provider,{value:t},e.children)},u="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},m=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,o=e.originalType,s=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),u=p(n),m=a,k=u["".concat(s,".").concat(m)]||u[m]||d[m]||o;return n?r.createElement(k,i(i({ref:t},c),{},{components:n})):r.createElement(k,i({ref:t},c))}));function k(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=n.length,i=new Array(o);i[0]=m;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l[u]="string"==typeof e?e:a,i[1]=l;for(var p=2;p<o;p++)i[p]=n[p];return r.createElement.apply(null,i)}return r.createElement.apply(null,n)}m.displayName="MDXCreateElement"},3030:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>i,default:()=>d,frontMatter:()=>o,metadata:()=>l,toc:()=>p});var r=n(7462),a=(n(7294),n(3905));const o={},i="Module 3: Pod Security",l={unversionedId:"module3/README",id:"module3/README",title:"Module 3: Pod Security",description:"Pod Security Policies (PSPs) were removed starting K8s 1.25 . PSPs were designed to control the security specification of Pods. However, they were not intuitive to use. They're now replaced by Pod Security Admission (PSAs) which help enforce Pod Security Standards (PSSs) on a namespace level.",source:"@site/docs/module3/README.md",sourceDirName:"module3",slug:"/module3/",permalink:"/kyverno-workshop/docs/module3/",draft:!1,tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Module 2: Kubernetes Best Practices using Kyverno",permalink:"/kyverno-workshop/docs/module2/"},next:{title:"Module 4: Supply chain security",permalink:"/kyverno-workshop/docs/module4/"}},s={},p=[{value:"Task 1",id:"task-1",level:2},{value:"PSA Limitations",id:"psa-limitations",level:2},{value:"Task 2",id:"task-2",level:2}],c={toc:p},u="wrapper";function d(e){let{components:t,...n}=e;return(0,a.kt)(u,(0,r.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"module-3-pod-security"},"Module 3: Pod Security"),(0,a.kt)("p",null,"Pod Security Policies (PSPs) were removed starting K8s ",(0,a.kt)("inlineCode",{parentName:"p"},"1.25")," . PSPs were designed to control the security specification of Pods. However, they were not intuitive to use. They're now replaced by Pod Security Admission (PSAs) which help enforce Pod Security Standards (PSSs) on a namespace level."),(0,a.kt)("p",null,"Pod Security Standards define three policies to broadly cover the security spectrum:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"privileged"),(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"Anything is allowed!"),(0,a.kt)("li",{parentName:"ul"},"Unrestricted"),(0,a.kt)("li",{parentName:"ul"},"System & Infra-level workloads"))),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"baseline"),(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"Minimally restricted"),(0,a.kt)("li",{parentName:"ul"},"Common workloads"))),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"restricted"),(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"Heavily restricted"),(0,a.kt)("li",{parentName:"ul"},"Security critical workloads")))),(0,a.kt)("h2",{id:"task-1"},"Task 1"),(0,a.kt)("p",null,"The following Policy would create a namespace with the ",(0,a.kt)("inlineCode",{parentName:"p"},"restricted")," Pod Security Admission configuration."),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"Create the namespace")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-yaml"},"apiVersion: v1\nkind: Namespace\nmetadata:\n  name: test-psa\n  labels:\n    pod-security.kubernetes.io/enforce: restricted\n")),(0,a.kt)("ol",{start:2},(0,a.kt)("li",{parentName:"ol"},"Attempt a pod admission")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"k -n test-psa run nginx --image=nginx\n")),(0,a.kt)("h2",{id:"psa-limitations"},"PSA Limitations"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"PSA and PSS were designed for simplicity of deployment and adoption",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"They are limited on their own"))),(0,a.kt)("li",{parentName:"ul"},"Restricted in scope",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"Applied at a namespace level"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"Example:")," Filtering based on label (",(0,a.kt)("inlineCode",{parentName:"li"},"purpose:  prod"),") not supported"))),(0,a.kt)("li",{parentName:"ul"},"Don't offer granular permissions",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"Limited to applying PSS policies only"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"Example:")," Can\u201a\xc4\xf6\u221a\xd1\u221a\xa5t have a policy to only allow pods with ",(0,a.kt)("inlineCode",{parentName:"li"},"securityContext.privileged:  false")))),(0,a.kt)("li",{parentName:"ul"},"Designed to rely on third-party tools such as Kyverno and OPA for finer control")),(0,a.kt)("h2",{id:"task-2"},"Task 2"),(0,a.kt)("p",null,"PSA is designed to act on every Pod in the specified namespace, let us see how we can add exceptions for specific Pods."),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"Create the Policy")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-yaml"},"apiVersion: kyverno.io/v1\nkind: Policy\nmetadata:\n  name: psa-host-namespaces\n  namespace: default\nspec:\n  background: true\n  validationFailureAction: Enforce\n  rules:\n  - name: restricted\n    match:\n      any:\n      - resources:\n          kinds:\n          - Pod\n    validate:\n      podSecurity:\n        level: restricted\n        version: latest\n        exclude:\n        - controlName: Host Namespaces\n")),(0,a.kt)("ol",{start:2},(0,a.kt)("li",{parentName:"ol"},"Attempt to admit the Pod")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-yaml"},"apiVersion: v1\nkind: Pod\nmetadata:\n  name: badpod01\nspec:\n  containers:\n  - name: container01\n    image: dummyimagename\n    securityContext:\n      privileged: true\n")),(0,a.kt)("ol",{start:3},(0,a.kt)("li",{parentName:"ol"},"Now try the following")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-yaml"},"apiVersion: v1\nkind: Pod\nmetadata:\n  name: badpod02\nspec:\n  hostIPC: true\n  containers:\n  - name: container01\n    image: dummyimagename\n")))}d.isMDXComponent=!0}}]);